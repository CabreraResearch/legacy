<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="shortcut icon" href="images/favicon.ico" />
    <title>ChemSW Live</title>
</head>
<body>
    <div id="spinner" width="100%" style="text-align: center; display: none;">
        <img src="images/ajax/progress.gif" /></div>
    <div id="rptDiv">
        
        <div id="divBody"></div>
    </div>
    <div id="DialogErrorDiv"></div>
    
    <!--#include file="MainIncludes.html" -->
    <!--#include file="DevIncludes.html" -->
    <script type="text/javascript">

        $(document).ready(
            Csw.method(function () {
                var cswPublic = { };
                var cswPrivate = {
                    parent: Csw.literals.factory($('#divBody'), cswPublic)
                };

                function stopSpinner() {
                    $('#spinner').hide();
                }

                Csw.subscribe(Csw.enums.events.ajax.globalAjaxStop, stopSpinner);

                function startSpinner() {
                    $('#spinner').show();
                }

                Csw.subscribe(Csw.enums.events.ajax.globalAjaxStart, startSpinner);

                Csw.ajaxWcf.get({
                    urlMethod: 'Trees/run/Equipment By Location',
                    success: function(data) {
                        console.log(data.Tree[0]);

                            Ext.QuickTips.init();

                            //we want to setup a model and store instead of using dataUrl
                            Ext.define('Tree', {
                                extend: 'Ext.data.Model',
                                fields: [
                                    {name: 'selected',     type: 'boolean'},
									{name: 'text',     type: 'string'},
                                    {name: 'nodetypeid', type: 'number'},
                                    {name: 'objectclassid', type: 'number'}
                                    
                                ]
                            });

                            var store = Ext.create('Ext.data.TreeStore', {
                                model: 'Tree',
                                root: data.Tree[0],
                                sorters: [{
                                    property: 'text',
                                    direction: 'ASC'
                                }]
                            });
							var allExpanded = false;
							var isMulti = false;
                            //Ext.ux.tree.TreeGrid is no longer a Ux. You can simply use a tree.TreePanel
                            window.myExtTree = Ext.create('Ext.tree.Panel', {
                                title: data.Tree[0].text,
                                width: 500,
                                height: 600,
								renderTo: 'divBody',
                                //collapsible: true,
                                useArrows: true,
                                rootVisible: false,
                                store: store,
                                multiSelect: true,
                                //singleExpand: true,
								hideHeaders: true,
								//the 'columns' property is now 'headers'
                                columns: [{
                                    xtype: 'checkcolumn',
                                    header: 'Selected',
									dataIndex: 'selected',
                                    width: 40,
                                    stopSelection: false,
                                    menuDisabled: true,
									hidden: true
                                }, {
                                    xtype: 'treecolumn', //this is so we know which column will show the tree
                                    dataIndex: 'text',
                                    menuDisabled: true,
									width: 500-40,
                                    checked: false
                                },{
                                    hidden: true,
									flex: 1,
                                    dataIndex: 'nodetypeid',
                                    menuDisabled: true,
                                },{
                                    hidden: true,
									flex: 1,
                                    dataIndex: 'objectclassid',
                                    menuDisabled: true,
                                }],
								dockedItems: [{
									xtype: 'toolbar',
									items: [{
										text: 'Toggle All',
										handler: function () {
											var toolbar = this.up('toolbar');
											toolbar.disable();
											
											if(allExpanded === false) {
												window.myExtTree.getEl().mask('Expanding tree...');
												window.myExtTree.expandAll(function () {
													window.myExtTree.getEl().unmask();
													toolbar.enable();
												});
											} else {
												window.myExtTree.getEl().mask('Collapsing tree...');
												window.myExtTree.collapseAll(function () {
													window.myExtTree.getEl().unmask();
													toolbar.enable();
												});
											}
											allExpanded = !allExpanded;
										}
									}, {
										text: 'Multi-Edit',
										handler: function () {
											var toolbar = this.up('toolbar');
											
											if(false === isMulti) {
												$('.x-tree-checkbox').show();
											} else {
												$('.x-tree-checkbox').hide();
											}
											isMulti = !isMulti;
										}
									}]
								}],
                                listeners: {
                                    afterlayout: function() {
                                        $('.x-tree-checkbox').hide();
                                    }
                                }
                            });
                        
						}
                });


                    
                


            })
        );
    </script>
</body>
</html>
