<!DOCTYPE html>
<html>
<head>
    <title>Page Title</title>
    <link href="js/thirdparty/jquery/core/jquery.mobile/jquery.mobile-1.0b1.css" rel="stylesheet"
        type="text/css" />
    <script src="js/thirdparty/jquery/core/jquery-1.6.1.js"></script>
    <script src="js/thirdparty/jquery/core/jquery.mobile/jquery.mobile-1.0b1.js"></script>
    <script type="text/javascript" src="js/_Global.js"></script>
</head>
<body id='CswMobile'>
	<div id="StaticPage1" data-role="page" data-url="StaticPage1" data-auto-back-btn="true"><div id="StaticHeader1" data-role="header"><h1>Static Header 1</h1></div><div id="StaticContent1" data-role="content" ></div></div>
    
    <script type="text/javascript">

        $(document).ready(function() {
			function bindJqm($div)
			{
				$div.bind('pageshow', function ()
				{
					var $this = $(this); //.page();
					loadContent($this);
				});
				return $div;
			}

			function loadContent($div)
			{
				var $content = $div.find('div:jqmData(role="content")').empty();
				var $ul = $('<ul data-role="listview" data-theme="b"></ul>'); //.listview();
				$content.append($ul);
				$ul.listview();

				CswAjaxJSON({
					url: 'http://192.168.1.16/NbtWebApp/wsNBT.asmx/GetTestData',
					data: {},
					success: function (links)
					{
						for (prop in links)
						{
							var id = links[prop].replace(' ', '').replace(' ', '');
							var text = links[prop];
							var $li = $('<li><a data-identity="' + id + '" data-url="' + id + '" href="javascript:void(0);" >' + text + '</a></li>');

							$ul.append($li);
							$ul.listview('refresh');
							$newPage = makePage(id, text);
							$li.find('a').bind('click', function ()
							{
								var dataurl = $(this).attr('data-url');
								var $thisPage = $('#' + dataurl);
								$.mobile.changePage($thisPage);
							});
						}
					},
					error: function (xml)
					{
						alert(xml);
					}
				});

			}

			function makePage(id,text)
			{
				var $page = $('#' + id);
				if ($page === undefined || $page.length === 0)
				{
					$page = $('<div id="' + id + '" ' + 'data-role="page" data-url="' + id + '" data-auto-back-btn="true">')
							.appendTo($('body'));

					var $header = $('<div id="Header_' + id + '" ' + 'data-role="header"><h1>Header of ' + text + '</h1>')
							  .appendTo($page);

					var $content = $('<div id="Content_' + id + '" ' + 'data-role="content">')
							   .appendTo($page);

					$page.append('<div id="Footer_' + id + '" ' + 'data-role="footer">');
					$page = bindJqm($page);
				}
				return $page;
			}

			var $static1 = $('#StaticPage1');
			bindJqm($static1);
		});
    </script>
</body>
</html>
