<!DOCTYPE html>
<html>
<head>
    <title>Page Title</title>
    <link href="http://code.jquery.com/mobile/latest/jquery.mobile.min.css" rel="stylesheet"
        type="text/css" />
    <script src="http://code.jquery.com/jquery-1.6.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/latest/jquery.mobile.min.js"></script>
    <script type="text/javascript" src="js/_Global.js"></script>
</head>
<body id='CswMobile'>
    
    
    <script type="text/javascript">

        function bindJqm($div)
        {
            $div.bind('pageshow', function ()
            {
                $.mobile.pageLoading();

                var $content = $div.find('div:jqmData(role="content")');
                var $ul = $('<ul data-role="listview" data-theme="b"></ul>'); //.listview();
                $content.append($ul);
                $ul.listview();

                CswAjaxJSON({
                    url: '/NbtWebApp/wsNBT.asmx/GetTestData',
                    data: {},
                    success: function (links)
                    {
                        //debugger;
                        for (prop in links)
                        {
                            log(prop);
                            var id = links[prop].replace(' ', '').replace(' ', '');
                            var text = links[prop];
                            var $li = $('<li><a data-identity="' + id + '" data-url="' + id + '" href="javascript:void(0);" >' + text + '</a></li>');
                            
                            $ul.append($li);
                            $ul.listview('refresh');
                            makePage(id, text);
                        }
                    }
                });

                $content.find('ul:jqmData(role="listview") a').bind('click', function ()
                {
                    debugger;
                    var dataurl = $(this).attr('data-url');
                    $.mobile.changePage(dataurl);
                });
                

                $.mobile.pageLoading(true);
            });
        }

        function makePage(id,text)
        {
            var $page = $('#' + id);
            if ($page === undefined || $page.length === 0)
            {
                $page = $('<div id="' + id + '" ' + 'data-role="page" data-url="' + id + '">')
                        .appendTo($('body'));

                var $header = $('<div id="Header_' + id + '" ' + 'data-role="header"><h1>Header of ' + text + '</h1>')
                          .appendTo($page);

                var $content = $('<div id="Content_' + id + '" ' + 'data-role="content">')
                           .appendTo($page);

                $page.append('<div id="Footer_' + id + '" ' + 'data-role="footer">');
            }
            if ($page !== undefined || $page.length !== 0)
            {
                $page.page();
                $page = bindJqm($page);
            }
            return $page;
        }

        var $static1 = $('<div id="StaticPage1" data-role="page" data-url="StaticPage1"><div id="StaticHeader1" data-role="header"><h1>Static Header 1</h1></div><div id="StaticContent1" data-role="content" ></div></div>');
        var $static2 = $('<div id="StaticPage2" data-role="page" data-url="StaticPage2"><div id="StaticHeader2" data-role="header"><h1>Static Header 2</h1></div><div id="StaticContent2" data-role="content" ></div></div>');
        $static1.page();
        bindJqm($static1);
        $('body').append($static1).append($static2);
        $static1.find('ul:jqmData(role="listview")').bind('click', function ()
        {
//            debugger;
            var dataurl = $(this).attr('data-url');
            $.mobile.changePage(dataurl);
        });

        



    </script>
</body>
</html>
