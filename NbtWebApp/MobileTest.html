<!DOCTYPE html>
<html>
<head>
    <title>Page Title</title>
    <link href="http://code.jquery.com/mobile/latest/jquery.mobile.min.css" rel="stylesheet"
        type="text/css" />
    <script src="http://code.jquery.com/jquery-1.6.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/latest/jquery.mobile.min.js"></script>
    <script type="text/javascript" src="js/_Global.js"></script>
</head>
<body id='CswMobile'>
    
    
    <script type="text/javascript">

        function bindJqm($div)
        {
            $div.bind('pageshow', function ()
            {
                $.mobile.pageLoading();

                var $content = $div.find('div:jqmData(role="content")');
                var $ul = $('<ul data-role="listview" data-theme="b"></ul>')
                var links = {
                    A: 'Static Page 1',
                    B: 'Static Page 2'
                };

                CswAjaxJSON({
                    async: false,
                    url: '/NbtWebApp/wsNBT.asmx/GetTestData',
                    data: {},
                    success: function (data)
                    {
                        if (data) $.extend(links, data);
                        for (var prop in data)
                        {
                            var id = data[prop].replace(' ', '');
                            var text = data[prop];
                            $ul.append($('<li><a data-identity="' + id + '" data-url="' + id + '" href="javascript:void(0);" >' + text + '</a>'));
                            makePage(id, text);
                        }
                    }
                });

                $ul.listview();
                $content.append($ul);


                $.mobile.pageLoading(true);
            });
            $div.bind('click', function ()
            {
                var dataurl = $(this).attr('data-url');
                $.mobile.changePage(dataurl);
            });
            return $div;
        }

        function makePage(id,text)
        {
            var $page = $('#' + id);
            if ($page === undefined || $page.length === 0)
            {
                $page = $('<div id="' + id + '" ' + 'data-role="page" data-url="' + id + '">')
                        .appendTo($('body'));

                var $header = $('<div id="Header_' + id + '" ' + 'data-role="header"><h1>Header of ' + text + '</h1>')
                          .appendTo($page);

                var $content = $('<div id="Content_' + id + '" ' + 'data-role="content">')
                           .appendTo($page);

                $page.append('<div id="Footer_' + id + '" ' + 'data-role="footer">');
            }
            $page = bindJqm($page).page();

            return $page;
        }

        var $static1 = $('<div id="StaticPage1" data-role="page" data-url="StaticPage1"><div id="StaticHeader1" data-role="header"><h1>Static Header 1</h1></div><div id="StaticContent1" data-role="content" ><ul data-role="listview" data-theme="b"><li><a data-identity="StaticPage1" data-url="StaticPage1" href="javascript:void(0);">Static Page 1</a></li><li><a data-identity="StaticPage2" data-url="StaticPage2" href="javascript:void(0);">Static Page 2</a></li><li><a data-identity="DynamicPageA" data-url="DynamicPageA" href="javascript:void(0);">Dynamic Page A</a></li><li><a data-identity="DynamicPageB" data-url="DynamicPageB" href="javascript:void(0);">Dynamic Page B</a></li></ul></div></div>');
        var $static2 = $('<div id="StaticPage2" data-role="page" data-url="StaticPage2"><div id="StaticHeader2" data-role="header"><h1>Static Header 2</h1></div><div id="StaticContent2" data-role="content"><ul data-role="listview" data-theme="b"><li><a data-identity="StaticPage1" data-url="StaticPage1" href="javascript:void(0);">Static Page 1</a></li><li><a data-identity="StaticPage2" data-url="StaticPage2" href="javascript:void(0);">Static Page 2</a></li><li><a data-identity="DynamicPageA" data-url="DynamicPageA" href="javascript:void(0);">Dynamic Page A</a></li><li><a data-identity="DynamicPageB" data-url="DynamicPageB" href="javascript:void(0);">Dynamic Page B</a></li></ul></div></div>');
        bindJqm($static1);
        $('body').append($static1).append($static2);
        $static1.find('ul:jqmData(role="listview")').bind('click', function ()
        {
            var dataurl = $(this).attr('data-url');
            $.mobile.changePage(dataurl);
        });

        



    </script>
</body>
</html>
