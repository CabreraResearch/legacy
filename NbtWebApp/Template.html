<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="shortcut icon" href="images/favicon.ico" />
    <title>ChemSW Live</title>
</head>
<body>
    <div id="spinner" width="100%" style="text-align: center; display: none;">
        <img src="images/ajax/progress.gif" /></div>
    <div id="rptDiv">
        
        <div id="divBody"></div>
    </div>
    <div id="DialogErrorDiv"></div>
    
    <!--#include file="MainIncludes.html" -->
    <!--#include file="DevIncludes.html" -->
    <script type="text/javascript">

        $(document).ready(
            Csw.method(function () {
                var cswPublic = { };
                var cswPrivate = {
                    parent: Csw.literals.factory($('#divBody'), cswPublic)
                };

                function stopSpinner() {
                    $('#spinner').hide();
                }

                Csw.subscribe(Csw.enums.events.ajax.globalAjaxStop, stopSpinner);

                function startSpinner() {
                    $('#spinner').show();
                }

                Csw.subscribe(Csw.enums.events.ajax.globalAjaxStart, startSpinner);

                Csw.ajaxWcf.get({
                    urlMethod: 'Trees/run/Equipment By Location',
                    success: function(data) {
                        console.log(data.Tree[0]);

                        var store = Ext.create('Ext.data.TreeStore', {
                            root: data.Tree[0],

                            sorters: [{
                                property: 'text',
                                direction: 'ASC'
                            }]
                        });
                        
                        window.myExtTree = Ext.create('Ext.tree.Panel', {
                            store: store,
                            renderTo: 'divBody',
                            height: 600,
                            width: 500,
                            title: data.Tree[0].text,
							rootVisible: false,
                            useArrows: true,
                            //multiSelect: true,

                            //selType: 'CheckboxModel',
                            selModel : { mode: 'Multi' },
                            dockedItems: [{
                                xtype: 'toolbar',
                                items: [{
                                    text: 'Expand All',
                                    handler: function () {
                                        window.myExtTree.getEl().mask('Expanding tree...');
                                        var toolbar = this.up('toolbar');
                                        toolbar.disable();

                                        window.myExtTree.expandAll(function () {
                                            window.myExtTree.getEl().unmask();
                                            toolbar.enable();
                                        });
                                    }
                                }, {
                                    text: 'Collapse All',
                                    handler: function () {
                                        var toolbar = this.up('toolbar');
                                        toolbar.disable();

                                        window.myExtTree.collapseAll(function () {
                                            toolbar.enable();
                                        });
                                    }
                                }]
                            }]
                        });
                    }
                });


            })
        );
    </script>
</body>
</html>
