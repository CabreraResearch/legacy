<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="shortcut icon" href="images/favicon.ico" />
    <title>ChemSW Live</title>
    <!--#include file="MainIncludes.html" -->
    <!--#include file="MainCswIncludes.html" -->
    <script type="text/javascript">

        window.onload = Csw.method(function () {
                var cswPublic = { };
                var cswPrivate = {
                    ID: 'print_label',
                    GetEPLTextUrl: 'getEPLText',
                    nodeid: '',
                    propid: '',
                    parent: Csw.literals.factory($('#divBody'), cswPublic),
                    stopSpinner: function () {
                        $('#spinner').hide();
                    },
                    startSpinner: function () { 
                        $('#spinner').show();
                    },
                    doPrint: '',
                    jZeb: {}
                };
                cswPublic.table = cswPrivate.parent.table();
                
                Csw.subscribe(Csw.enums.events.ajax.globalAjaxStop, cswPrivate.stopSpinner);
                Csw.subscribe(Csw.enums.events.ajax.globalAjaxStart, cswPrivate.startSpinner);
                
                cswPrivate.queryString = Csw.queryString();

                
                var data = {
                    PropId: Csw.string(cswPrivate.queryString.PropId),
                    PrintLabelNodeId: Csw.string(cswPrivate.queryString.PrintLabelNodeId)
                };
                var ret = Csw.ajax.post({
                    urlMethod: cswPrivate.GetEPLTextUrl,
                    data: data,
                    success: function(data) {

                        var labelx;

                        cswPrivate.jZeb = cswPublic.table.cell(1,1).jZebra();
                        cswPrivate.jZeb.findPrinters();
                        cswPrivate.doPrint = function() {
                            var printer = $('#printersList').val();
                            cswPrivate.jZeb.setDefaultPrinter(printer);
                            return cswPrivate.jZeb.print(data.epl);
                        };

                    },
                    error: function (data) {

                    }
                }); // ajax
            
                var printBtn = cswPublic.table.cell(1,2).buttonExt({
                icon: Csw.enums.getName(Csw.enums.iconType, Csw.enums.iconType.barcode),
                    width: '100px',
                    bindOnEnter: true,
                    ID: 'print_label_print',
                    enabledText: 'Print',
                    disableOnClick: false,
                    onClick: function() {
                        cswPrivate.doPrint();
                    }
                });
                
                return cswPublic;

            });
        

        
    </script>
</head>
<body>
    <div id="content">
        <div id="spinner" width="100%" style="text-align: center; display: none;">
            <img src="images/ajax/progress.gif" />
        </div>

        <h4 id="title">Select a Raw Text printer and click Print to begin printing.</h4>
        <h5 id="processing"></h5>
        <div id="divBody">

        </div>

        <div id="DialogErrorDiv"></div>

        <div id="hiddenDiv" style="visibility: hidden; border: 1px solid red;">
            <applet id="jzebra" name="jzebra" code="jzebra.PrintApplet.class" archive="/vendor/jZebra/jzebra.jar" width="50" height="50"></applet>    
        </div>    

        <div id="bottom" align="right" stye="text-align: right;">
            <h6 id="footer"></h6>
        </div>
    </div>
</body>
</html>
