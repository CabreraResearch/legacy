<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="shortcut icon" href="images/favicon.ico" />
    <title>ChemSW Live</title>
    <!--#include file="MainIncludes.html" -->
    <!--#include file="DevIncludes.html" -->
    <script type="text/javascript">

        window.onload = Csw.method(function () {
                var cswPublic = { };
                var cswPrivate = {
                    ID: 'print_label',
                    nodeid: '',
                    propid: '',
                    parent: Csw.literals.factory($('#divBody'), cswPublic),
                    stopSpinner: function () {
                        $('#spinner').hide();
                    },
                    startSpinner: function () { 
                        $('#spinner').show();
                    },
                    doPrint: '',
                    jZeb: {}
                };
                                
                Csw.subscribe(Csw.enums.events.ajax.globalAjaxStop, cswPrivate.stopSpinner);
                Csw.subscribe(Csw.enums.events.ajax.globalAjaxStart, cswPrivate.startSpinner);
                cswPrivate.table = cswPublic.table();
                cswPrivate.queryString = Csw.queryString();
                
                    var ret = Csw.ajaxWcf.get({
                        urlMethod: 'Labels/label/' + Csw.string(cswPrivate.queryString.PrintLabelNodeId) + '/target/' + Csw.string(cswPrivate.queryString.TargetId),
                        success: function(data) {
                            //TODO: display x of n labels printing
                            //TODO: each(label in data) print(); update counter;
                            var labelx;

                            if (data.controltype === 'ActiveX') {
                                cswPrivate.doPrint = function() {
                                    labelx = $('#labelx').get(0);
                                    labelx.EPLScript = data.epl;
                                    labelx.Print();
                                };
                            } else {
                            //cswPrivate.onZebraReady();
                                cswPrivate.jZeb.findPrinters();
                                cswPrivate.doPrint = function() {
                                    var printer = $('#printersList').val();
                                    cswPrivate.jZeb.setDefaultPrinter(printer);
                                    return cswPrivate.jZeb.print(data.epl);
                                };
                            }

                        },
                        error: function (data) {

                        }
                    }); // ajax
                
                    var printBtn = cswPrivate.table.cell(1,2).buttonExt({
                    icon: Csw.enums.getName(Csw.enums.iconType, Csw.enums.iconType.barcode),
                        size: 'medium',
                        width: '100px',
                        bindOnEnter: true,
                        ID: 'print_label_print',
                        enabledText: 'Print',
                        disableOnClick: false,
                        onClick: function() {
                            cswPrivate.doPrint();
                        }
                    });

                cswPrivate.jZeb = cswPrivate.table.cell(1,1).jZebra();

                return cswPublic;

            });
        

        
    </script>
</head>
<body>
   
    <div id="content">
         <div id="spinner" width="100%" style="text-align: center; display: none;">
            <img src="images/ajax/progress.gif" />
        </div>

    <h4 id="title">Select a Raw Text printer and click Print to begin printing barcodes.</h4>
    <h5 id"processing"></h5>
    <div id="divBody">


    </div>


    <div id="DialogErrorDiv"></div>
    <div id="hiddenDiv" style="visibility: hidden; border: 1px solid red;">
        <applet id="jzebra" name="jzebra" code="jzebra.PrintApplet.class" archive="/vendor/jZebra/jzebra.jar" width="0" height="0"></applet>    
        <OBJECT ID="labelx" Name="labelx" classid="clsid:A8926827-7F19-48A1-A086-B1A5901DB7F0" codebase="CafLabelPrintUtil.cab#version=0,1,6,0" width=0 height=0 align=center hspace=0 vspace=0></OBJECT>
    </div>    
    <div id="bottom" align="right" stye="text-align: right;">
        <h6 id="footer"></h6>
    </div>

    </div>
    
</body>
</html>
