<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="shortcut icon" href="images/favicon.ico" />
    <title>ChemSW Live</title>
    <!--#include file="MainIncludes.html" -->
    <!--#include file="MainCswIncludes.html" -->
    <script type="text/javascript">

        $(document).ready(
            Csw.method(function () {
                var cswPublic = { };
                var cswPrivate = {
                    ID: 'print_label',
                    GetEPLTextUrl: 'getEPLText',
                    nodeid: '',
                    propid: '',
                    parent: Csw.literals.factory($('#divBody'), cswPublic),
                    stopSpinner: function () {
                        $('#spinner').hide();
                    },
                    startSpinner: function () { 
                        $('#spinner').show();
                    },
                    doPrint: '',
                    jZeb: {}
                };
                cswPublic.div = cswPrivate.parent.div();
                
                Csw.subscribe(Csw.enums.events.ajax.globalAjaxStop, cswPrivate.stopSpinner);
                Csw.subscribe(Csw.enums.events.ajax.globalAjaxStart, cswPrivate.startSpinner);
                
                cswPrivate.queryString = Csw.queryString();

                Csw.subscribe('jZebra_Ready', function() {
                    var data = {
                        PropId: Csw.string(cswPrivate.queryString.PropId),
                        PrintLabelNodeId: Csw.string(cswPrivate.queryString.PrintLabelNodeId)
                    };
                    var ret = Csw.ajax.post({
                        urlMethod: cswPrivate.GetEPLTextUrl,
                        data: data,
                        success: function(data) {

                            var labelx;

                            if (data.controltype === 'ActiveX') {
                                cswPrivate.doPrint = function() {
                                    labelx = $('#labelx').get(0);
                                    labelx.EPLScript = data.epl;
                                    labelx.Print();
                                };
                            } else {
                                cswPrivate.jZeb.findPrinters();
                                cswPrivate.doPrint = function() {
                                    var printer = $('#printersList').val();
                                    cswPrivate.jZeb.setDefaultPrinter(printer);
                                    return cswPrivate.jZeb.print(data.epl);
                                };
                            }

                        },
                        error: function (data) {

                        }
                    }); // ajax
                
                    var printBtn = cswPublic.div.buttonExt({
                        icon: Csw.enums.getName(Csw.enums.iconType, Csw.enums.iconType.print),
                        width: '100px',
                        bindOnEnter: true,
                        ID: 'print_label_print',
                        enabledText: 'Print',
                        //disabledText: 'Printing...', 
                        disableOnClick: false,
                        onClick: function() {
                            cswPrivate.doPrint();
                        }
                    });
                });

                cswPrivate.jZeb = cswPublic.div.jZebra();

                return cswPublic;

            })
        

        );
    </script>
</head>
<body>
    <div id="spinner" width="100%" style="text-align: center; display: none;">
        <img src="images/ajax/progress.gif" /></div>
    <div id="rptDiv">
        <div id="divBody"></div>
    </div>
    <div id="DialogErrorDiv"></div>
    <div id="hiddenDiv" style="visibility: hidden; border: 1px solid red;">
        <applet id="jZebra" name="jZebra" code="jzebra.PrintApplet.class" archive="js/thirdparty/jZebra/jzebra.jar" width="0" height="0"></applet>
        <OBJECT ID="labelx" Name="labelx" classid="clsid:A8926827-7F19-48A1-A086-B1A5901DB7F0" codebase="CafLabelPrintUtil.cab#version=0,1,6,0" width=0 height=0 align=center hspace=0 vspace=0></OBJECT>
    </div>    

</body>
</html>
