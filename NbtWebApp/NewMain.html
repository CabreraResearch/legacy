<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!--#include file="NewHeader.html" -->

					<tr>
						<td id="Td5" class="PageTable_LeftColumn" rowspan="5">
							<img src="Images/pagelayout/blank.gif" alt="X" width="1" height="450"/>
						</td>

						<td id="HeaderTable_BottomMenu" class="HeaderTable_BottomMenu" colspan="2">
							<table cellpadding="0" cellspacing="0">
								<tr>
									<td><img id="headerblank4" src="Images/pagelayout/blank.gif" alt="X" width="1" height="30"/></td>
									<td><div id="MainMenuDiv"></div></td>
								</tr>
							</table>
						</td>

						<td id="Td7" class="PageTable_RightColumn" rowspan="5"></td>
					</tr>

					<tr>
						<td colspan="2">
							<div id="ErrorDiv" class="ErrorContent" style="display: none;"></div>
						</td>
					</tr>
		  
					<tr>
						<td id="Td2" class="PageTable_LeftCell" valign="top">
							<div id="ViewSelectDiv"></div>
							<div id="LeftDiv"></div>
						</td>
						<td id="Td3" class="PageTable_RightCell" valign="top" style="padding-left: 5px;">
							<div id="RightDiv"></div>
						</td>
					</tr>
										  
					<tr>
						<td id="Td6" class="PageTable_CenterCell" colspan="2" valign="top">
							<div id="CenterDiv"></div>
						</td>
					</tr>
					
					<tr>
						<td id="Td8" class="PageTable_CenterCell" colspan="2" valign="top">
							<div id="QuickLaunch"></div>
					</td>
					</tr>


<script type="text/javascript">

	var debug = true;

	initAll();

	function initAll()
	{
		if (debug) log('NewMain.initAll()');
		$('#CenterDiv').CswLogin('login', {
			'onAuthenticate': function (u)
			{
				var view = GetCurrentView();
				var initOpt = {
					ID: 'mainviewselect',
					'onSelect': handleItemSelect,
					'onLinkClick': handleItemSelect,
					'onLogout': function ()
					{
						$('#CenterDiv').CswLogin('logout', {
							onDeauthenticate: function ()
							{
								window.location = 'NewMain.html';
							}
						});
					}
				};

				$('#header_username').text(u);
				$('#header_dashboard').CswDashboard();
				$('#header_menu').CswMenuHeader({ 'onLogout': initOpt.onLogout });
				$('#ViewSelectDiv').CswViewSelect({ 'ID': initOpt.ID, 'onSelect': initOpt.onSelect });

				if (view.viewid == null)
				{
					$('#CenterDiv').CswWelcome({ 'onLinkClick': initOpt.onLinkClick });
				} else
				{
					handleItemSelect({ 'viewid': view.viewid, viewmode: view.viewmode });
					//getNodesTree( {'viewid': view.viewid} );
				}

				$('#QuickLaunch').CswQuickLaunch({ 'onLinkClick': initOpt.onLinkClick });

			} // onAuthenticate
		});  // CswLogin
	} // initAll()

	function clear(options)
	{
		var o = {left: false, right: false, center: false};
		if(options) $.extend(o,options);

		if (debug)
		{
			log('NewMain.clear()');
			log(o);
		}

		if (o.left)
		{
			$('#LeftDiv').contents().remove();
		}
		if (o.right)
		{
			$('#RightDiv').contents().remove();
		}
		if (o.center)
		{
			$('#CenterDiv').contents().remove();
		}
	}

	function handleItemSelect(options) 
	{
		clear({ left: true, right: true, center: true });
		var o = {
					type: 'view',
					viewmode: 'tree',
					itemid: '', 
					text: '', 
					iconurl: '',
					viewid: '',
					actionid: '',
					reportid: '',
					linktype: '',
					cswnbtnodekey: ''
				 };
		if (options) {
			$.extend(o, options);
		}
		
		SetCurrentView({ viewid: o.viewid, viewmode: o.viewmode });
		
        if( o.viewid != undefined && o.viewid != '' && o.viewmode != undefined && o.viewmode != '' )
		{
		    switch(o.viewmode)
		    {
			    case 'grid':
			    {
				    if (debug) log('handleItemSelect() called getViewGrid()');
                    getViewGrid( { 'viewid': o.viewid, 'nodeid': '', 'cswnbtnodekey': o.cswnbtnodekey } );
				    break;
			    }
			    case 'list':
			    {
			        if (debug) log('handleItemSelect() called getNodesTree()');
			        getNodesTree({ 'viewid': o.viewid, 'viewmode': o.viewmode });
				    break;
			    }
			    case 'tree': 
			    {
                    if(debug) log('handleItemSelect() called getNodesTree()');
                    getNodesTree({ 'viewid': o.viewid, 'viewmode': o.viewmode });
				    break;
			    }
                default:
                {
                    alert('No View Selected!');
                    break;
                }
            }
        }
		else if(o.type != undefined && o.type != '')
		{
			switch(o.type)
			{
				case 'action':
				{
					alert('Actions are not yet handled!');
					break;
				}
				case 'report':
				{
					alert('Reports are not yet handled!');
					break;
				}
				default:
				{
					alert('Handling for link type ' + o.linktype + ' is not implemented yet.');
					break;
				}
			}
		}
	}
	
	function refreshMainMenu(options) {
		var o = {
			viewid: '',
			nodeid: '',
			cswnbtnodekey: '',
			onAddNode: ''
		};

		o.onAddNode = function (opt) { //newnodeid, newcswnbtnodekey
			refreshViewTree(opt); } //newnodeid, newcswnbtnodekey

		if (options)
		{
			$.extend(o, options);
		}

		if (debug) log('NewMain.refreshMainMenu()');
		if (debug) log(o);

		$('#MainMenuDiv').CswMenuMain( {'viewid': o.viewid, 'nodeid': o.nodeid, 'cswnbtnodekey': o.cswnbtnodekey, 'onAddNode': o.onAddNode} );
	}

	function getViewGrid(options)
	{
		var o = {
			viewid: '',
			nodeid: '',
			cswnbtnodekey: '',
			id: 'CswNodeGrid'
		};
		if (options)
		{
			$.extend(o, options);
		}

		if (debug)
		{
			log('NewMain.getViewGrid()');
			log(o);
		}
		
		$('#CenterDiv').CswNodeGrid({ 'viewid': o.viewid, 'nodeid': o.nodeid, 'cswnbtnodekey': o.cswnbtnodekey, 'id': o.id });
	}

	function getNodesTree(options) {
		var o = {
		    viewid: '',
            viewmode: 'tree',
			'ID': 'main',
			'onSelectNode': ''
		};

		o.onSelectNode = function (opt) { //nodeid, nodename, iconurl, cswnbtnodekey 
			onSelectTreeNode(opt); }

		if (options) 		
		{
			$.extend(o, options);
		}

		if (debug) 
		{
			log('NewMain.getNodesTree() on ' + o.viewmode + ' view');
			//log(o);
		}

		$('#LeftDiv').CswNodeTree('init', {'ID': o.ID, 'viewid': o.viewid, 'viewmode': o.viewmode, 'onSelectNode': o.onSelectNode} );
	}

	function onSelectTreeNode(options) {
		var o = {
			viewid: '', 
			nodeid: '', 
			cswnbtnodekey: ''
		};
		if (options)
		{
			$.extend(o, options);
		}

		if (debug)
		{
			log('NewMain.onSelectTreeNode()');
			//log(o);
		}

		getTabs( {'nodeid': o.nodeid, 'cswnbtnodekey': o.cswnbtnodekey} );  //nodeid, cswnbtnodekey
		refreshMainMenu({ 'viewid': o.viewid, 'nodeid': o.nodeid, 'cswnbtnodekey': o.cswnbtnodekey }); //viewid, nodeid, cswnbtnodekey
	}

	function getTabs(options)
	{
		var o = {
			nodeid: '',
			cswnbtnodekey: '',
			onSave: refreshViewTree
		};
		if (options)
		{
			$.extend(o, options);
		}

		if (debug)
		{
			log('NewMain.getTabs()');
			//log(o);
		}

		clear({right: true});
		$('#RightDiv').CswNodeTabs({ 'nodeid': o.nodeid, 'cswnbtnodekey': o.cswnbtnodekey, 'onSave': o.onSave });
	}

	function refreshViewTree(options)
	{
		var view = GetCurrentView();

		var o = {
			newnodeid: '',
			newcswnbtnodekey: '',
			nodeid: '',
			cswnbtnodekey: '',
			'ID': 'main',
			nodename: '', 
			iconurl: '',
			'onSelectNode': ''
		};
		o.onSelectNode = function (opt) { //nodeid, nodename, iconurl, cswnbtnodekey
			   onSelectTreeNode(opt); } //viewid, nodeid, cswnbtnodekey
		
		if (options)
		{
			$.extend(o, options);
		}

		if (debug)
		{
			log('NewMain.refreshViewTree()');
			//log(o);
		}

		clear({left: true});
		$('#LeftDiv').CswNodeTree('init', {'ID': o.ID, 'viewid': view.viewid, 'nodeid': o.nodeid, 'onSelectNode': o.onSelectNode });
	}

</script>

<!--#include file="NewFooter.html" -->
