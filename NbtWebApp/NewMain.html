<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!--#include file="NewHeader.html" -->

					<tr>
						<td id="Td5" class="PageTable_LeftColumn" rowspan="5">
							<img src="Images/pagelayout/blank.gif" width="1" height="450"/>
						</td>

						<td id="HeaderTable_BottomMenu" class="HeaderTable_BottomMenu" colspan="2">
							<table cellpadding="0" cellspacing="0">
								<tr>
									<td><img id="headerblank4" src="Images/pagelayout/blank.gif" width="1" height="30"/></td>
									<td><div id="MainMenuDiv"></div></td>
								</tr>
							</table>
						</td>

						<td id="Td7" class="PageTable_RightColumn" rowspan="5"></td>
					</tr>

					<tr>
						<td colspan="2">
							<div id="ErrorDiv" class="ErrorContent" style="display: none;"></div>
						</td>
					</tr>
		  
					<tr>
						<td id="Td2" class="PageTable_LeftCell" valign="top">
							<div id="ViewSelectDiv"></div>
							<div id="LeftDiv"></div>
						</td>
						<td id="Td3" class="PageTable_RightCell" valign="top" style="padding-left: 5px;">
							<div id="RightDiv"></div>
						</td>
					</tr>
										  
					<tr>
						<td id="Td6" class="PageTable_CenterCell" colspan="2" valign="top">
							<div id="CenterDiv"></div>
						</td>
					</tr>
					
					<tr>
						<td id="Td8" class="PageTable_CenterCell" colspan="2" valign="top">
							<div id="QuickLaunch"></div>
					</td>
					</tr>

<script type="text/javascript">
	var debug = false;

	initAll();

	function initAll()
	{
		if (debug) log('NewMain.initAll()');
		$('#CenterDiv').CswLogin('login', {
			'onAuthenticate': function (u) {
				$('#header_username').text(u);
				$('#header_dashboard').CswDashboard();
				$('#header_menu').CswMenuHeader({ onLogout: function () {
					$('#CenterDiv').CswLogin('logout', { onDeauthenticate: function () {
						window.location = 'NewMain.html';
					}
					});
				}
				});

				$('#ViewSelectDiv').CswViewSelect({ ID: 'mainviewselect', 'onSelect': handleItemSelect });

				var viewid = GetCurrentViewId();
				if (viewid == null) {
					$('#CenterDiv').CswWelcome({
						onLinkClick: handleItemSelect
					});
				} else {
					getViewTree(viewid);
				}

				$('#QuickLaunch').CswQuickLaunch({
					onLinkClick: handleItemSelect
				});

			} // onAuthenticate
		}); // CswLogin
	} // initAll()

	function clearLeft()
	{
		if (debug) log('NewMain.clearLeft()');
		$('#LeftDiv').children().remove();
	}
	function clearRight()
	{
		if (debug) log('NewMain.clearRight()');
		$('#RightDiv').children().remove();
	}
	function clearCenter()
	{
		if (debug) log('NewMain.clearCenter()');
		$('#CenterDiv').children().remove();
	}

	function handleItemSelect(optSelect) 
	{
		clearCenter();
		var o = {
					type: 'view',
					viewmode: 'tree',
					itemid: '', 
					text: '', 
					iconurl: '',
					viewid: '',
					actionid: '',
					reportid: '',
					linktype: '',
					cswnbtnodekey: ''
				 };
		if (optSelect) {
			$.extend(o, optSelect);
		}
   
		switch(o.viewmode)
		{
			case 'grid':
			{
				if( o.viewid != undefined && o.viewid != '' )
				{
					getViewGrid(o.viewid,o.cswnbtnodekey);
				}
				else
				{
					alert('No View Selected!');
				}
				break;
			}
			case 'list':
			{
				alert('List Views not yet supported!');
				break;
			}
			case 'tree': 
			{
				if( o.viewid != undefined && o.viewid != '' )
				{
					getViewTree(o.viewid);
				}
				else
				{
					alert('No View Selected!');
				}
				break;
			}
			default:
			{
				switch(o.type)
				{
					case 'action':
					{
						alert('Actions are not yet handled!');
						break;
					}
					case 'report':
					{
						alert('Reports are not yet handled!');
						break;
					}
					default:
					{
						alert('Handling for link type ' + o.linktype + ' is not implemented yet.');
						break;
					}
				}				
				break;
			}
		}
	}
	function refreshMainMenu(optSelect)
	{
	    var o = {
	        viewid: '',
            nodeid: '',
            cswnbtnodekey: ''
	    };
        if (optSelect)
	    {
	        $.extend(o, optSelect);
	    }

		if (debug) log('NewMain.refreshMainMenu()');
		$('#MainMenuDiv').CswMenuMain({
			'viewid': o.viewid,
			'nodeid': o.nodeid,
			'cswnbtnodekey': o.cswnbtnodekey,
			onAddNode: function (optAddNode) { //newnodeid, newcswnbtnodekey
			    refreshViewTree(optSelect); //newnodeid, newcswnbtnodekey
			}
		});
	}

	function getViewTree(optSelect)
	{
	    var o = {
	        viewid: '',
	        nodeid: '',
	        cswnbtnodekey: '',
            nodename: '', 
            iconurl: ''
	    };
	    if (optSelect)
	    {
	        $.extend(o, optSelect);
	    }
		if (debug) log('NewMain.getViewTree()');
		SetCurrentViewId(o);
		clearLeft();
		clearRight();
		clearCenter();
		$('#LeftDiv').CswNodeTree('init', {
			'ID': 'main',
			'viewid': o.viewid,
			'onSelectNode': function (o) //nodeid, nodename, iconurl, cswnbtnodekey 
                { onSelectViewTreeNode(o); } //viewid, nodeid, cswnbtnodekey
		});
	}

	function onSelectViewTreeNode(optSelect) {
	    var o = {
	        viewid: '', 
            nodeid: '', 
            cswnbtnodekey: ''
	    };
	    if (optSelect)
	    {
	        $.extend(o, optSelect);
	    }
        
        if (debug) log('NewMain.onSelectViewTreeNode()');
        getTabs(o); //nodeid, cswnbtnodekey
        refreshMainMenu(o); //viewid, nodeid, cswnbtnodekey
	}

	function getViewGrid(optSelect)
	{
	    var o = {
	        viewid: '',
	        nodeid: '',
	        cswnbtnodekey: '',
	        id: 'CswNodeGrid'
	    };
	    if (optSelect)
	    {
	        $.extend(o, optSelect);
	    }
		if (debug) log('NewMain.getViewGrid()');
		SetCurrentViewId(o);
		clearLeft();
		clearRight();
		clearCenter();
		$('#CenterDiv').CswNodeGrid( {}, o );
	}

	function getTabs(optSelect)
	{
	    var o = {
	        nodeid: '',
	        cswnbtnodekey: '',
	        onSave: refreshViewTree
	    };
	    if (optSelect)
	    {
	        $.extend(o, optSelect);
	    }
	    log('NewMain getTabs()');
	    log(o.cswnbtnodekey);
		if (debug) log('NewMain.getTabs()');
		clearRight();
		$('#RightDiv').CswNodeTabs(o); //{ 'nodeid': nodeid, 'cswnbtnodekey': cswnbtnodekey, onSave: refreshViewTree }
	}

	function refreshViewTree(optSelect)
	{
	    var o = {
	        newnodeid: '',
	        newcswnbtnodekey: '',
	        nodeid: '',
	        cswnbtnodekey: '',
            'ID': 'main',
            viewid: GetCurrentViewId(),
            nodename: '', 
            iconurl: ''
	    };
	    if (optSelect)
	    {
	        $.extend(o, optSelect);
	    }
		if (debug) log('NewMain.refreshViewTree()');
		clearLeft();
		//var viewid = GetCurrentViewId();
		$('#LeftDiv').CswNodeTree('init', {
			'ID': o.ID,
			'viewid': o.viewid,
			'nodeid': o.newnodeid,
			'cswnbtnodekey': o.newcswnbtnodekey,
			'onSelectNode': function (o) //nodeid, nodename, iconurl, cswnbtnodekey
			    { onSelectViewTreeNode(o); } //viewid, nodeid, cswnbtnodekey
		});
	}

</script>

<!--#include file="NewFooter.html" -->
