<!DOCTYPE html>
<html> <!-- manifest="Mobile.manifest"> <!--Still not ready for primetime-->
<head>
    <base href="Mobile.html"/>
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1" />
    <title>Main</title>
    <link rel="shortcut icon" href="images/favicon.ico" />
    <!--#include file="Mobile_Includes_Head.html" -->
</head>

<body id="CswMobile_Body">
    <!--#include file="Mobile_Includes_Body.html" -->
    <script type="text/javascript">

        function redirectOnError(e)
        {
            var $refreshPage = $('#' + localStorage['refreshPage']);
            if ($refreshPage)
            {
                $.mobile.changePage($refreshPage);
            }
            else
            {
                window.location.href = window.location.pathname;
            }
            if (debugOn())
            {
                alert(e);
                errorHandler(e, true, true, true);
            }
            else
            {
                errorHandler(e);
            }
        }

        window.onerror = function(e)
        {
            redirectOnError(e);
        };
        
        try {
            if( hasWebStorage() ) {

                // override value in _Globals.js
		        homeUrl = "Mobile.html";

		        $(document).ready(function ()
		        {

		            $(window).bind("orientationchange resize pageshow", function () { fixGeometry(); });

		            $(window).bind("pageshow", function (e) { cswPage(e); });

		            $('body').CswMobile({
		                'Theme': 'b'
		            });
		        });
            }
            else {
                throw('This browser does not support localStorage.');
            }
        }
        catch(e) {
            redirectOnError();
        }

        function fixGeometry()
        {
            //thanks to: http://www.semicomplete.com/blog/geekery/jquery-mobile-full-height-content.html
            /* Some orientation changes leave the scroll position at something
            * that isn't 0,0. This is annoying for user experience. */
            scroll(0, 0);

            /* Calculate the geometry that our content area should take */
            var header = $("div[data-role='header']:visible");
            var footer = $("div[data-role='footer']:visible");
            var content = $("div[data-role='content']:visible:visible");
            
            var viewport_height = $(window).height();
            var content_height = viewport_height - header.outerHeight() - footer.outerHeight();
            if ((content.outerHeight() - header.outerHeight() - footer.outerHeight()) <= viewport_height)
            {
                content_height -= (content.outerHeight() - content.height() );
                content.height(content_height);
            } /* Trim margin/border/padding height */
        };

        function cswPage(e) {
            var $content = $.mobile.activePage;
            if( $content.length === 0 || isNullOrEmpty($content) ) {
                $content = $("div[data-role='page']:visible:visible");
            }
            if ($content.length === 0 || isNullOrEmpty($content)) {
                $content = $('#' + e.target.id);
            }
            if ($content.length === 0 || isNullOrEmpty($content)) {
                $content = $('#' + $.mobile.getPath());
            }

            $content.page();
            
            $content.find('ul').page();
            $('.csw_listview').page();
            $('.csw_answer').page();
        }
        
    </script>
</body>
</html>
